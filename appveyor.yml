#---------------------------------#
#      general configuration      #
#---------------------------------#

# version format
version: 1.0.{build}-{branch}

# GitHub PR related builds do not increment build number
pull_requests:
  do_not_increment_build_number: true


# branches to build
branches:
  only:
    - master
    - Release
    - /^issue_#\d+/

#---------------------------------#
#    environment configuration    #
#---------------------------------#

image: Visual Studio 2017

# environment variables
environment:
  SONAR_TOKEN:
    secure: Al/QvEu97dsdwBLxeWeYnHPw4XjgBmkVmLLLw5X+qAMAAkoMVz5aRIBow4iQKsur

cache:
  - packages -> **\packages.config

services:
  - mssql2017

#---------------------------------#
#       build configuration       #
#---------------------------------#

# In VolleyManagement.WebClient we have angular application, dependencies for this project can't be downloaded because MSBuild can't build it.
# So without resolved dependencies error is thrown and sonar can't analyze code without typescript.
# Command used to install typescript locally.
install:
  - npm install -D typescript
  
build_script:
- ps: >-
    cd .\build

    .\build.ps1

#---------------------------------#
#       tests configuration       #
#---------------------------------#

test: off # should be handled by Cake

#---------------------------------#
#         notifications           #
#---------------------------------#

notifications:
# Regular Slack notification
- provider: Slack
  incoming_webhook: 
    secure: jtHxp04P8ZgVc9mY2zXKJs/yDfE72wGJrqJxpovpjaoabGHAA5FWpsyQFOMn3eauhMX03M71DtukIEXKP7NUKpsmdXROh85iXtkk+8lWX+4=
  on_build_success: false
  on_build_failure: true
  on_build_status_changed: true